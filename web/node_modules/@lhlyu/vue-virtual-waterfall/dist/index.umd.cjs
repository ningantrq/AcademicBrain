(function(u,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(u=typeof globalThis!="undefined"?globalThis:u||self,e(u.VueVirtualWaterfall={},u.Vue))})(this,function(u,e){"use strict";var Y=Object.defineProperty;var B=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var R=(u,e,v)=>e in u?Y(u,e,{enumerable:!0,configurable:!0,writable:!0,value:v}):u[e]=v,j=(u,e)=>{for(var v in e||(e={}))L.call(e,v)&&R(u,v,e[v]);if(B)for(var v of B(e))V.call(e,v)&&R(u,v,e[v]);return u};var H=(u,e)=>{var v={};for(var w in u)L.call(u,w)&&e.indexOf(w)<0&&(v[w]=u[w]);if(u!=null&&B)for(var w of B(u))e.indexOf(w)<0&&V.call(u,w)&&(v[w]=u[w]);return v};function v(o){return e.getCurrentScope()?(e.onScopeDispose(o),!0):!1}function w(o){return typeof o=="function"?o():e.unref(o)}const F=typeof window!="undefined"&&typeof document!="undefined";typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;const P=Object.prototype.toString,G=o=>P.call(o)==="[object Object]",N=()=>{};function D(o){return o||e.getCurrentInstance()}function O(o,n=!0,r){const s=D(r);s?e.onMounted(o,s):n?o():e.nextTick(o)}function b(o){var n;const r=w(o);return(n=r==null?void 0:r.$el)!=null?n:r}const A=F?window:void 0;function T(...o){let n,r,s,x;if(typeof o[0]=="string"||Array.isArray(o[0])?([r,s,x]=o,n=A):[n,r,s,x]=o,!n)return N;Array.isArray(r)||(r=[r]),Array.isArray(s)||(s=[s]);const d=[],c=()=>{d.forEach(m=>m()),d.length=0},p=(m,t,l,i)=>(m.addEventListener(t,l,i),()=>m.removeEventListener(t,l,i)),f=e.watch(()=>[b(n),w(x)],([m,t])=>{if(c(),!m)return;const l=G(t)?j({},t):t;d.push(...r.flatMap(i=>s.map(a=>p(m,i,a,l))))},{immediate:!0,flush:"post"}),y=()=>{f(),c()};return v(y),y}function K(){const o=e.ref(!1);return e.getCurrentInstance()&&e.onMounted(()=>{o.value=!0}),o}function q(o){const n=K();return e.computed(()=>(n.value,!!o()))}function $(o,n,r={}){const t=r,{window:s=A}=t,x=H(t,["window"]);let d;const c=q(()=>s&&"ResizeObserver"in s),p=()=>{d&&(d.disconnect(),d=void 0)},f=e.computed(()=>Array.isArray(o)?o.map(l=>b(l)):[b(o)]),y=e.watch(f,l=>{if(p(),c.value&&s){d=new ResizeObserver(n);for(const i of l)i&&d.observe(i,x)}},{immediate:!0,flush:"post",deep:!0}),m=()=>{p(),y()};return v(m),{isSupported:c,stop:m}}function U(o,n={}){const{reset:r=!0,windowResize:s=!0,windowScroll:x=!0,immediate:d=!0}=n,c=e.ref(0),p=e.ref(0),f=e.ref(0),y=e.ref(0),m=e.ref(0),t=e.ref(0),l=e.ref(0),i=e.ref(0);function a(){const h=b(o);if(!h){r&&(c.value=0,p.value=0,f.value=0,y.value=0,m.value=0,t.value=0,l.value=0,i.value=0);return}const g=h.getBoundingClientRect();c.value=g.height,p.value=g.bottom,f.value=g.left,y.value=g.right,m.value=g.top,t.value=g.width,l.value=g.x,i.value=g.y}return $(o,a),e.watch(()=>b(o),h=>!h&&a()),x&&T("scroll",a,{capture:!0,passive:!0}),s&&T("resize",a,{passive:!0}),O(()=>{d&&a()}),{height:c,bottom:p,left:f,right:y,top:m,width:t,x:l,y:i,update:a}}function J(o,n={width:0,height:0},r={}){const{window:s=A,box:x="content-box"}=r,d=e.computed(()=>{var t,l;return(l=(t=b(o))==null?void 0:t.namespaceURI)==null?void 0:l.includes("svg")}),c=e.ref(n.width),p=e.ref(n.height),{stop:f}=$(o,([t])=>{const l=x==="border-box"?t.borderBoxSize:x==="content-box"?t.contentBoxSize:t.devicePixelContentBoxSize;if(s&&d.value){const i=b(o);if(i){const a=s.getComputedStyle(i);c.value=Number.parseFloat(a.width),p.value=Number.parseFloat(a.height)}}else if(l){const i=Array.isArray(l)?l:[l];c.value=i.reduce((a,{inlineSize:h})=>a+h,0),p.value=i.reduce((a,{blockSize:h})=>a+h,0)}else c.value=t.contentRect.width,p.value=t.contentRect.height},r);O(()=>{const t=b(o);t&&(c.value="offsetWidth"in t?t.offsetWidth:n.width,p.value="offsetHeight"in t?t.offsetHeight:n.height)});const y=e.watch(()=>b(o),t=>{c.value=t?n.width:0,p.value=t?n.height:0});function m(){f(),y()}return{width:c,height:p,stop:m}}const Q=["data-index"],E=e.defineComponent({name:"VirtualWaterfall",__name:"virtual-waterfall",props:{virtual:{type:Boolean,default:!0},rowKey:{default:"id"},gap:{default:15},preloadScreenCount:{default:()=>[0,0]},itemMinWidth:{default:220},maxColumnCount:{default:10},minColumnCount:{default:2},items:{default:()=>[]},calcItemHeight:{type:Function,default:(o,n)=>250}},setup(o){const n=o;e.useSlots();const r=e.ref(),{width:s}=J(r),{top:x}=U(r);e.onMounted(()=>{s.value===0&&(s.value=Number.parseInt(window.getComputedStyle(r.value).width))});const d=e.computed(()=>{if(!s.value)return 0;const t=s.value-n.gap*2;if(t>=n.itemMinWidth*2){const l=Math.floor(t/n.itemMinWidth);return n.maxColumnCount&&l>n.maxColumnCount?n.maxColumnCount:l}return n.minColumnCount}),c=e.ref(new Array(d.value).fill(n.gap)),p=e.computed(()=>{if(!s.value||d.value<=0)return 0;const t=(d.value-1)*n.gap+n.gap*2;return Math.floor((s.value-t)/d.value)}),f=e.ref([]);e.watchEffect(()=>{if(!d.value){f.value=[];return}const t=n.items.length,l=new Array(t);let i=0;const a=f.value.length&&t>f.value.length;a?i=f.value.length:c.value=new Array(d.value).fill(n.gap);for(let h=0;h<t;h++){if(a&&h<i){l[h]=f.value[h];continue}const g=m(),C=n.calcItemHeight(n.items[h],p.value),S=c.value[g],W={index:h,item:n.items[h],column:g,top:S,left:(p.value+n.gap)*g+n.gap,bottom:S+C,height:C};c.value[g]+=C+n.gap,l[h]=W}f.value=l});const y=e.computed(()=>{const t=f.value.length;if(!t)return[];if(!n.virtual)return f.value;const l=r.value.parentElement.offsetTop,i=-x.value+l,[a,h]=n.preloadScreenCount,g=r.value.parentElement.clientHeight,C=i-a*g,S=i+(h+1)*g;let W=0,z=0,I=!0;for(let M=0;M<t;M++){const _=f.value[M].top,k=f.value[M].bottom;(_>=C&&_<=S||k>=C&&k<=S||_<C&&k>S)&&(I&&(W=M,I=!1),z=M)}return f.value.slice(W,z+1)}),m=()=>c.value.indexOf(Math.min(...c.value));return(t,l)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"content",ref:r,style:e.normalizeStyle({position:"relative",willChange:"height",height:`${Math.max(...c.value)}px`})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,i=>{var a;return e.openBlock(),e.createElementBlock("div",{key:(a=i.item[t.rowKey])!=null?a:i.index,style:e.normalizeStyle({position:"absolute",contentVisibility:"auto",width:`${p.value}px`,height:`${i.height}px`,transform:`translate(${i.left}px, ${i.top}px)`,containIntrinsicSize:`${p.value}px ${i.height}px`}),"data-index":i.index},[e.renderSlot(t.$slots,"default",{item:i.item,index:i.index})],12,Q)}),128))],4))}}),X={install(o){o.component(E.name,E)}};u.VirtualWaterfall=E,u.default=X,Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
