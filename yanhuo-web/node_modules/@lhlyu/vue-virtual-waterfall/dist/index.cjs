"use strict";var V=Object.defineProperty;var S=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var k=(e,t,u)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[t]=u,z=(e,t)=>{for(var u in t||(t={}))O.call(t,u)&&k(e,u,t[u]);if(S)for(var u of S(t))$.call(t,u)&&k(e,u,t[u]);return e};var I=(e,t)=>{var u={};for(var l in e)O.call(e,l)&&t.indexOf(l)<0&&(u[l]=e[l]);if(e!=null&&S)for(var l of S(e))t.indexOf(l)<0&&$.call(e,l)&&(u[l]=e[l]);return u};Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const n=require("vue");function L(e){return n.getCurrentScope()?(n.onScopeDispose(e),!0):!1}function T(e){return typeof e=="function"?e():n.unref(e)}const F=typeof window!="undefined"&&typeof document!="undefined";typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;const P=Object.prototype.toString,G=e=>P.call(e)==="[object Object]",N=()=>{};function D(e){return e||n.getCurrentInstance()}function H(e,t=!0,u){const l=D(u);l?n.onMounted(e,l):t?e():n.nextTick(e)}function w(e){var t;const u=T(e);return(t=u==null?void 0:u.$el)!=null?t:u}const A=F?window:void 0;function R(...e){let t,u,l,h;if(typeof e[0]=="string"||Array.isArray(e[0])?([u,l,h]=e,t=A):[t,u,l,h]=e,!t)return N;Array.isArray(u)||(u=[u]),Array.isArray(l)||(l=[l]);const f=[],s=()=>{f.forEach(v=>v()),f.length=0},d=(v,o,r,i)=>(v.addEventListener(o,r,i),()=>v.removeEventListener(o,r,i)),a=n.watch(()=>[w(t),T(h)],([v,o])=>{if(s(),!v)return;const r=G(o)?z({},o):o;f.push(...u.flatMap(i=>l.map(c=>d(v,i,c,r))))},{immediate:!0,flush:"post"}),g=()=>{a(),s()};return L(g),g}function K(){const e=n.ref(!1);return n.getCurrentInstance()&&n.onMounted(()=>{e.value=!0}),e}function q(e){const t=K();return n.computed(()=>(t.value,!!e()))}function j(e,t,u={}){const o=u,{window:l=A}=o,h=I(o,["window"]);let f;const s=q(()=>l&&"ResizeObserver"in l),d=()=>{f&&(f.disconnect(),f=void 0)},a=n.computed(()=>Array.isArray(e)?e.map(r=>w(r)):[w(e)]),g=n.watch(a,r=>{if(d(),s.value&&l){f=new ResizeObserver(t);for(const i of r)i&&f.observe(i,h)}},{immediate:!0,flush:"post",deep:!0}),v=()=>{d(),g()};return L(v),{isSupported:s,stop:v}}function U(e,t={}){const{reset:u=!0,windowResize:l=!0,windowScroll:h=!0,immediate:f=!0}=t,s=n.ref(0),d=n.ref(0),a=n.ref(0),g=n.ref(0),v=n.ref(0),o=n.ref(0),r=n.ref(0),i=n.ref(0);function c(){const p=w(e);if(!p){u&&(s.value=0,d.value=0,a.value=0,g.value=0,v.value=0,o.value=0,r.value=0,i.value=0);return}const m=p.getBoundingClientRect();s.value=m.height,d.value=m.bottom,a.value=m.left,g.value=m.right,v.value=m.top,o.value=m.width,r.value=m.x,i.value=m.y}return j(e,c),n.watch(()=>w(e),p=>!p&&c()),h&&R("scroll",c,{capture:!0,passive:!0}),l&&R("resize",c,{passive:!0}),H(()=>{f&&c()}),{height:s,bottom:d,left:a,right:g,top:v,width:o,x:r,y:i,update:c}}function J(e,t={width:0,height:0},u={}){const{window:l=A,box:h="content-box"}=u,f=n.computed(()=>{var o,r;return(r=(o=w(e))==null?void 0:o.namespaceURI)==null?void 0:r.includes("svg")}),s=n.ref(t.width),d=n.ref(t.height),{stop:a}=j(e,([o])=>{const r=h==="border-box"?o.borderBoxSize:h==="content-box"?o.contentBoxSize:o.devicePixelContentBoxSize;if(l&&f.value){const i=w(e);if(i){const c=l.getComputedStyle(i);s.value=Number.parseFloat(c.width),d.value=Number.parseFloat(c.height)}}else if(r){const i=Array.isArray(r)?r:[r];s.value=i.reduce((c,{inlineSize:p})=>c+p,0),d.value=i.reduce((c,{blockSize:p})=>c+p,0)}else s.value=o.contentRect.width,d.value=o.contentRect.height},u);H(()=>{const o=w(e);o&&(s.value="offsetWidth"in o?o.offsetWidth:t.width,d.value="offsetHeight"in o?o.offsetHeight:t.height)});const g=n.watch(()=>w(e),o=>{s.value=o?t.width:0,d.value=o?t.height:0});function v(){a(),g()}return{width:s,height:d,stop:v}}const Q=["data-index"],B=n.defineComponent({name:"VirtualWaterfall",__name:"virtual-waterfall",props:{virtual:{type:Boolean,default:!0},rowKey:{default:"id"},gap:{default:15},preloadScreenCount:{default:()=>[0,0]},itemMinWidth:{default:220},maxColumnCount:{default:10},minColumnCount:{default:2},items:{default:()=>[]},calcItemHeight:{type:Function,default:(e,t)=>250}},setup(e){const t=e;n.useSlots();const u=n.ref(),{width:l}=J(u),{top:h}=U(u);n.onMounted(()=>{l.value===0&&(l.value=Number.parseInt(window.getComputedStyle(u.value).width))});const f=n.computed(()=>{if(!l.value)return 0;const o=l.value-t.gap*2;if(o>=t.itemMinWidth*2){const r=Math.floor(o/t.itemMinWidth);return t.maxColumnCount&&r>t.maxColumnCount?t.maxColumnCount:r}return t.minColumnCount}),s=n.ref(new Array(f.value).fill(t.gap)),d=n.computed(()=>{if(!l.value||f.value<=0)return 0;const o=(f.value-1)*t.gap+t.gap*2;return Math.floor((l.value-o)/f.value)}),a=n.ref([]);n.watchEffect(()=>{if(!f.value){a.value=[];return}const o=t.items.length,r=new Array(o);let i=0;const c=a.value.length&&o>a.value.length;c?i=a.value.length:s.value=new Array(f.value).fill(t.gap);for(let p=0;p<o;p++){if(c&&p<i){r[p]=a.value[p];continue}const m=v(),x=t.calcItemHeight(t.items[p],d.value),y=s.value[m],C={index:p,item:t.items[p],column:m,top:y,left:(d.value+t.gap)*m+t.gap,bottom:y+x,height:x};s.value[m]+=x+t.gap,r[p]=C}a.value=r});const g=n.computed(()=>{const o=a.value.length;if(!o)return[];if(!t.virtual)return a.value;const r=u.value.parentElement.offsetTop,i=-h.value+r,[c,p]=t.preloadScreenCount,m=u.value.parentElement.clientHeight,x=i-c*m,y=i+(p+1)*m;let C=0,E=0,_=!0;for(let b=0;b<o;b++){const M=a.value[b].top,W=a.value[b].bottom;(M>=x&&M<=y||W>=x&&W<=y||M<x&&W>y)&&(_&&(C=b,_=!1),E=b)}return a.value.slice(C,E+1)}),v=()=>s.value.indexOf(Math.min(...s.value));return(o,r)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"content",ref:u,style:n.normalizeStyle({position:"relative",willChange:"height",height:`${Math.max(...s.value)}px`})},[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(g.value,i=>{var c;return n.openBlock(),n.createElementBlock("div",{key:(c=i.item[o.rowKey])!=null?c:i.index,style:n.normalizeStyle({position:"absolute",contentVisibility:"auto",width:`${d.value}px`,height:`${i.height}px`,transform:`translate(${i.left}px, ${i.top}px)`,containIntrinsicSize:`${d.value}px ${i.height}px`}),"data-index":i.index},[n.renderSlot(o.$slots,"default",{item:i.item,index:i.index})],12,Q)}),128))],4))}}),X={install(e){e.component(B.name,B)}};exports.VirtualWaterfall=B;exports.default=X;
